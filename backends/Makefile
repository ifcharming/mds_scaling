include ../Makefile.inc

# detect what platform we're building on
$(shell ./build_detect_platform build_config.mk)
# this file is generated by the previous line to set build flags and sources
include build_config.mk

CFLAGS += -iquote ..
LDFLAGS += `pkg-config fuse --libs` $(LEVELDBLIBRARY)

metadb_fs.o : metadb_fs.c operations.h
	$(CC) $(CFLAGS) -c metadb_fs.c

rpc_fs.o : rpc_fs.c operations.h
	$(CC) $(CFLAGS) -c local_fs.c
						
local_fs.o : local_fs.c operations.h
	$(CC) $(CFLAGS) -c local_fs.c
						

metadb_fs_test.o : metadb_fs_test.c operations.h
	$(CC) $(CFLAGS) -c metadb_fs_test.c ../common.a

metadb_fs_test : metadb_fs_test.o metadb_fs.o
	$(CC) -o $@ $^ ../common.a $(LDFLAGS)

metadb_insert_test.o : metadb_insert_test.c operations.h
	$(CC) $(CFLAGS) -c metadb_insert_test.c ../common.a

metadb_insert_test : metadb_insert_test.o metadb_fs.o
	$(CC) -o $@ $^ ../common.a $(LDFLAGS)

clean :
	rm -f *.o metadb_fs_test metadb_insert_test
